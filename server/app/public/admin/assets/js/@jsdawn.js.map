{"version":3,"file":"@jsdawn.js","sources":["../../../node_modules/@jsdawn/vue3-tinymce/dist/vue3-tinymce.es.js"],"sourcesContent":["import { reactive, watch, onMounted, onActivated, onDeactivated, onBeforeUnmount, openBlock, createElementBlock, Fragment, createElementVNode, toDisplayString, createCommentVNode } from \"vue\";\nconst uuid = (prefix) => {\n  return prefix + \"_\" + (Date.now() + Math.floor(Math.random() * 1e6));\n};\nconst getTinymce = () => {\n  const root = typeof window !== \"undefined\" ? window : global;\n  return root && \"tinymce\" in root ? root.tinymce : null;\n};\nfunction getContent(editor) {\n  if (!editor)\n    return \"\";\n  return editor.getContent();\n}\nfunction setContent(val, editor) {\n  if (!editor)\n    return;\n  editor.setContent(val);\n}\nfunction resetContent(val, editor) {\n  if (!editor)\n    return;\n  if (!!editor.resetContent)\n    return editor.resetContent(val);\n  editor.setContent(val);\n  editor.setDirty(false);\n  editor.undoManager.clear();\n}\nfunction setModeDisabled(editor, disabled = true) {\n  if (!editor)\n    return;\n  editor.mode.set(disabled ? \"readonly\" : \"design\");\n}\nfunction imageUploadHandler(setting, blobInfo, progress) {\n  return new Promise((resolve, reject) => {\n    let {\n      images_upload_url,\n      images_upload_credentials,\n      custom_images_upload_header,\n      custom_images_upload_param,\n      custom_images_upload_callback\n    } = setting || {};\n    let xhr, formData;\n    xhr = new XMLHttpRequest();\n    xhr.withCredentials = !!images_upload_credentials;\n    xhr.open(\"POST\", images_upload_url || \"\");\n    if (custom_images_upload_header) {\n      Object.keys(custom_images_upload_header).forEach((key) => {\n        xhr.setRequestHeader(key, custom_images_upload_header[key]);\n      });\n    }\n    xhr.upload.onprogress = function(e) {\n      progress(e.loaded / e.total * 100);\n    };\n    xhr.onload = function() {\n      if (xhr.status === 403) {\n        reject({ message: \"HTTP Error: \" + xhr.status, remove: true });\n        return;\n      }\n      if (xhr.status < 200 || xhr.status >= 300) {\n        reject(\"HTTP Error: \" + xhr.status);\n        return;\n      }\n      let json = JSON.parse(xhr.responseText);\n      if (!json) {\n        reject(\"Invalid JSON: \" + xhr.responseText);\n        return;\n      }\n      let backImgUrl = typeof custom_images_upload_callback === \"function\" ? custom_images_upload_callback(json) : json.location;\n      if (!backImgUrl) {\n        reject(\"Failed Path: location image path is error/empty\");\n        return;\n      }\n      resolve(backImgUrl);\n    };\n    xhr.onerror = function() {\n      reject(\n        \"Image upload failed due to a XHR Transport error. Code: \" + xhr.status\n      );\n    };\n    formData = new FormData();\n    formData.append(\"file\", blobInfo.blob(), blobInfo.filename());\n    if (custom_images_upload_param) {\n      Object.keys(custom_images_upload_param).forEach((key) => {\n        formData.append(key, custom_images_upload_param[key]);\n      });\n    }\n    xhr.send(formData);\n  });\n}\nfunction getContentStyle(style) {\n  const defaultStyle = `body{font-size: 14px;} img{padding: 0 2px;} `;\n  return defaultStyle + (style ? style : \"\");\n}\nconst scriptLoaderCreator = () => {\n  let state = {\n    status: {},\n    loadedCallbacks: {}\n  };\n  const creactScriptElm = (url, callback) => {\n    const scriptElm = document.createElement(\"script\");\n    scriptElm.id = uuid(\"tiny-script\");\n    scriptElm.type = \"application/javascript\";\n    scriptElm.src = url;\n    scriptElm.referrerPolicy = \"origin\";\n    const handler = () => {\n      scriptElm.removeEventListener(\"load\", handler);\n      callback();\n    };\n    scriptElm.addEventListener(\"load\", handler);\n    (document.head || document.body).appendChild(scriptElm);\n  };\n  const execCallbacks = (url) => {\n    if (!state.loadedCallbacks[url])\n      return;\n    state.loadedCallbacks[url].forEach((callback) => {\n      if (typeof callback[\"handler\"] === \"function\") {\n        callback[\"handler\"].call(callback.scope);\n      }\n    });\n    state.loadedCallbacks[url] = void 0;\n  };\n  const load = (url, callback, scope) => {\n    if (callback) {\n      if (!state.loadedCallbacks[url]) {\n        state.loadedCallbacks[url] = [];\n      }\n      state.loadedCallbacks[url].push({\n        handler: callback,\n        scope: scope || globalThis\n      });\n    }\n    if (state.status[url] === \"LOADED\") {\n      execCallbacks(url);\n      return;\n    }\n    if (state.status[url] !== \"LOADING\") {\n      state.status[url] = \"LOADING\";\n      creactScriptElm(url, () => {\n        state.status[url] = \"LOADED\";\n        execCallbacks(url);\n      });\n    }\n  };\n  return {\n    load\n  };\n};\nconst scriptLoader = scriptLoaderCreator();\nconst _hoisted_1 = [\"id\"];\nconst _hoisted_2 = { key: 0 };\nconst __default__ = {\n  name: \"Vue3Tinymce\"\n};\nconst _sfc_main = /* @__PURE__ */ Object.assign(__default__, {\n  props: {\n    modelValue: String,\n    setting: { type: Object, default: () => ({}) },\n    setup: Function,\n    disabled: Boolean,\n    scriptSrc: String,\n    debug: Boolean\n  },\n  emits: [\"update:modelValue\", \"init\", \"change\"],\n  setup(__props, { expose, emit }) {\n    const props = __props;\n    let mounting = true;\n    const state = reactive({\n      editor: null,\n      id: uuid(\"tinymce\"),\n      err: \"\"\n    });\n    const getModelValue = () => {\n      var _a;\n      return String((_a = props.modelValue) != null ? _a : \"\");\n    };\n    const updateValue = (val) => emit(\"update:modelValue\", val);\n    const printLog = (e, val, oldVal) => {\n      if (!props.debug)\n        return;\n      console.log(`\\u6765\\u81EA\\uFF1A${e.type} | \n ${val} \n ${oldVal || \"--\"}`);\n    };\n    const onChanged = (e, editor) => {\n      if (!editor)\n        editor = state.editor;\n      const content = getContent(editor);\n      printLog(e, content);\n      updateValue(content);\n      emit(\"change\", content);\n    };\n    const onInited = (editor) => {\n      setContent(getModelValue(), editor);\n      if (props.disabled && editor.mode.get() !== \"readonly\") {\n        setModeDisabled(editor);\n      }\n      editor.on(\"change input undo redo\", (e) => {\n        onChanged(e, editor);\n      });\n      emit(\"init\", editor);\n    };\n    const initEditor = () => {\n      var _a;\n      if (getTinymce() === null) {\n        state.err = \"tinymce is null\";\n        return;\n      }\n      if (props.debug) {\n        console.warn(\"vue3-tinymce \\u8FDB\\u5165debug\\u6A21\\u5F0F\");\n      }\n      let setting = {\n        ...props.setting,\n        selector: `#${state.id}`,\n        content_style: getContentStyle((_a = props.setting) == null ? void 0 : _a.content_style),\n        setup: (editor) => {\n          state.editor = editor;\n          if (props.setup)\n            props.setup(editor);\n          editor.on(\"init\", () => onInited(editor));\n        }\n      };\n      if (props.setting.custom_images_upload) {\n        setting.images_upload_handler = (...arg) => {\n          return imageUploadHandler.apply(null, [props.setting, ...arg]);\n        };\n      }\n      getTinymce().init(setting);\n      mounting = false;\n    };\n    watch(\n      () => props.modelValue,\n      (val, oldVal) => {\n        if (!state.editor || !state.editor.initialized)\n          return;\n        if (oldVal === val || val === getContent(state.editor))\n          return;\n        printLog({ type: \"propsChanged to setContent\" }, val, oldVal);\n        if (val === null)\n          return resetContent(\"\", state.editor);\n        setContent(getModelValue(), state.editor);\n      }\n    );\n    watch(\n      () => props.disabled,\n      (val) => {\n        if (!state.editor || !state.editor.initialized)\n          return;\n        setModeDisabled(state.editor, val);\n      }\n    );\n    expose({\n      id: state.id,\n      editor: state.editor\n    });\n    onMounted(() => {\n      var _a;\n      if (getTinymce() !== null) {\n        initEditor();\n        return;\n      }\n      const scriptSrc = (_a = props.scriptSrc) != null ? _a : \"https://cdn.bootcdn.net/ajax/libs/tinymce/6.1.2/tinymce.min.js\";\n      scriptLoader.load(scriptSrc, initEditor);\n    });\n    onActivated(() => {\n      if (!mounting)\n        initEditor();\n    });\n    onDeactivated(() => {\n      var _a;\n      if (!state.editor)\n        return;\n      (_a = getTinymce()) == null ? void 0 : _a.remove(`#${state.id}`);\n    });\n    onBeforeUnmount(() => {\n      var _a;\n      if (!state.editor)\n        return;\n      (_a = getTinymce()) == null ? void 0 : _a.remove(`#${state.id}`);\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(Fragment, null, [\n        createElementVNode(\"div\", {\n          id: state.id,\n          class: \"tiny-textarea\"\n        }, null, 8, _hoisted_1),\n        state.err ? (openBlock(), createElementBlock(\"p\", _hoisted_2, toDisplayString(state.err), 1)) : createCommentVNode(\"\", true)\n      ], 64);\n    };\n  }\n});\n_sfc_main.install = function(app) {\n  app.component(\"Vue3Tinymce\", _sfc_main);\n};\nexport { _sfc_main as default };\n"],"names":["uuid","prefix","Date","now","Math","floor","random","getTinymce","root","window","global","tinymce","getContent","editor","setContent","val","setModeDisabled","disabled","mode","set","imageUploadHandler","setting","blobInfo","progress","Promise","resolve","reject","xhr","formData","images_upload_url","images_upload_credentials","custom_images_upload_header","custom_images_upload_param","custom_images_upload_callback","XMLHttpRequest","withCredentials","open","Object","keys","forEach","key","setRequestHeader","upload","onprogress","e","loaded","total","onload","status","message","remove","json","JSON","parse","responseText","backImgUrl","location","onerror","FormData","append","blob","filename","send","scriptLoader","state","loadedCallbacks","execCallbacks","url","callback","call","scope","load","push","handler","globalThis","scriptElm","document","createElement","id","type","src","referrerPolicy","removeEventListener","addEventListener","head","body","appendChild","creactScriptElm","scriptLoaderCreator","_hoisted_1","_hoisted_2","__default__","name","_sfc_main","assign","props","modelValue","String","default","setup","Function","Boolean","scriptSrc","debug","emits","__props","expose","emit","mounting","reactive","err","getModelValue","_a","printLog","oldVal","console","log","onChanged","content","initEditor","warn","selector","content_style","style","on","get","onInited","custom_images_upload","images_upload_handler","arg","apply","init","watch","initialized","resetContent","setDirty","undoManager","clear","onMounted","onActivated","onDeactivated","onBeforeUnmount","_ctx","_cache","openBlock","createElementBlock","Fragment","createElementVNode","class","toDisplayString","createCommentVNode","install","app","component"],"mappings":"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","x_google_ignoreList":[0]}